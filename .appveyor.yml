image:
  - Visual Studio 2017
clone_depth: 10
configuration: Release
platform: AnyCPU
install:
  - cmd: powershell choco install doxygen.portable --version 1.8.11 || exit 0
before_build:
  - dotnet --version
build_script:
  - cmd: python codingtools\dotnetcore_run_unittests.py
  - cmd: python codingtools\dotnetcore_make_release.py --local --doxygen doxygen.exe
after_build:
  - cmd: 7z a bam.zip %APPVEYOR_BUILD_FOLDER%\bam_publish\*
  - cmd: 7z a bam.tar %APPVEYOR_BUILD_FOLDER%\bam_publish\*
  - cmd: 7z a bam_docs.zip %APPVEYOR_BUILD_FOLDER%\docs || exit 0
artifacts:
  - path: bam.zip
    name: Bam Zip Archive
  - path: bam.tar
    name: Bam Tar Archive
  - path: bam_docs.zip
    name: Bam Documentation Zip Archive
on_success:
    ps: Start-AppveyorBuild -ApiKey $env:ACCOUNT_API_KEY -ProjectSlug 'bam-imageformats' -EnvironmentVariables @{
       BAM_branch = $env:APPVEYOR_REPO_BRANCH
    }
on_finish:
  - ps: |
      $wc = New-Object 'System.Net.WebClient'
      $wc.UploadFile("https://ci.appveyor.com/api/testresults/mstest/$env:APPVEYOR_JOB_ID", (Resolve-Path .\bam_unittests\bin\Release\netcoreapp2.1\TestResults*.trx))
