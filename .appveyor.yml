image: Visual Studio 2017
clone_depth: 1
configuration: Release
platform: AnyCPU
#install:
  # default Nuget version is 2.8.x, which gives NUnit errors - using the latest does not
  # latest NuGet (4.6) gives this error: Unhandled Exception: System.MissingMethodException: Method not found: '!!0[] System.Array.Empty()'.
  # which is apparently due to .NET Framework 4.6 not being available (because of VS2013 above)
  #- appveyor DownloadFile https://dist.nuget.org/win-x86-commandline/v4.5.1/nuget.exe
before_build:
  - cmd: dotnet --version
  #- nuget restore BuildAMation.sln
build_script:
  - python codingtools\dotnetcore_run_unittests.py
  - python codingtools\dotnetcore_make_release.py
after_build:
  - 7z a bam.zip %APPVEYOR_BUILD_FOLDER%\bam_publish\bin\ %APPVEYOR_BUILD_FOLDER%\bam_publish\packages\ %APPVEYOR_BUILD_FOLDER%\bam_publish\tests\ %APPVEYOR_BUILD_FOLDER%\bam_publish\env.bat %APPVEYOR_BUILD_FOLDER%\bam_publish\Changelog.txt %APPVEYOR_BUILD_FOLDER%\bam_publish\License.md %APPVEYOR_BUILD_FOLDER%\bam_publish\MS-PL.md
artifacts:
  - path: bam.zip
    name: Bam
test_script:
  - "SET PATH=C:\\Python27-x64;%PATH%"
  - cd bam_publish
  - env.bat
  - python tests\runtests.py -x Mingw --VisualC.version=15.0 -b Native -c debug -c profile -j0 -d
  - python tests\runtests.py -x Mingw --VisualC.version=15.0 -b VSSolution -c debug -c profile -j0 -d
  - python tests\runtests.py -x Mingw --VisualC.version=15.0 -b MakeFile -c debug -c profile -j0 -d --MakeFile.format=NMAKE
  - cd ..
  #- python codingtools\\test_bam.py
  #- env.bat
  #- cd tests
  #- python runtests.py -x Mingw --VisualC.version=12.0 -b Native -c debug -c profile -j0 -d
  #- python runtests.py -x Mingw --VisualC.version=12.0 -b VSSolution -c debug -c profile -j0 -d
  #- python runtests.py -x Mingw --VisualC.version=12.0 -b MakeFile -c debug -c profile -j0 -d --MakeFile.format=NMAKE
  #- cd ..
on_finish:
  #- ps: |
  #    $wc = New-Object 'System.Net.WebClient'
  #    $wc.UploadFile("https://ci.appveyor.com/api/testresults/nunit3/$env:APPVEYOR_JOB_ID", (Resolve-Path .\TestResult.xml))
