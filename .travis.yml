git:
  depth: 1
notifications:
  email:
     on_success: always
     on_failure: always
language: csharp
install:
  # GCC ObjectiveC, GNUStep and 32-bit GCC and G++, and 32-bit X11 development files for Test12; chrpath for ChrpathTest1; doxygen for doc generation
  - if [ $TRAVIS_OS_NAME = linux ]; then sudo apt-get install gobjc gnustep-devel gcc-multilib g++-multilib libx11-dev libx11-dev:i386 chrpath doxygen; fi
matrix:
  include:
  - os: linux
    dist: trusty
    mono: none
    dotnet: 2.1.401
    script:
      - python codingtools/dotnetcore_run_unittests.py
      - python codingtools/dotnetcore_make_release.py --local --doxygen doxygen
      - cd bam_publish
      - source env.sh
      - python tests/runtests.py --Gcc.version=4.8 -b Native -c debug -c profile -j0 -d
      - python tests/runtests.py --Gcc.version=4.8 -b Native -c debug -c profile -j0 -d -b MakeFile
      - cd ..
  - os: osx
    osx_image: xcode8.3
    mono: none
    dotnet: 2.1.401
    script:
      - python codingtools/dotnetcore_run_unittests.py
      - python codingtools/dotnetcore_make_release.py --local
      - cd bam_publish
      - source env.sh
      - python tests/runtests.py --Clang.version=Xcode8 -b Native -c debug -c profile -j0 -d
      #- python tests/runtests.py --Clang.version=Xcode8 -b Native -c debug -c profile -j0 -d -b MakeFile
      - python tests/runtests.py --Clang.version=Xcode8 -b Native -c debug -c profile -j0 -d -b Xcode
      - cd ..
  - os: osx
    osx_image: xcode9.4
    mono: none
    dotnet: 2.1.401
    script:
      - python codingtools/dotnetcore_run_unittests.py
      - python codingtools/dotnetcore_make_release.py --local
      - cd bam_publish
      - source env.sh
      - python tests/runtests.py --Clang.version=Xcode9 -b Native -c debug -c profile -j0 -d
      #- python tests/runtests.py --Clang.version=Xcode9 -b Native -c debug -c profile -j0 -d -b MakeFile
      #- python tests/runtests.py --Clang.version=Xcode9 -b Native -c debug -c profile -j0 -d -b Xcode
      - cd ..
  - os: osx
    osx_image: xcode10
    mono: none
    dotnet: 2.1.401
    script:
      - python codingtools/dotnetcore_run_unittests.py
      - python codingtools/dotnetcore_make_release.py --local
      - cd bam_publish
      - source env.sh
      - python tests/runtests.py --Clang.version=Xcode10 -b Native -c debug -c profile -j0 -d --C.bitdepth=64
      #- python tests/runtests.py --Clang.version=Xcode10 -b Native -c debug -c profile -j0 -d --C.bitdepth=64 -b MakeFile
      #- python tests/runtests.py --Clang.version=Xcode10 -b Native -c debug -c profile -j0 -d --C.bitdepth=64 -b Xcode
      - cd ..
# Xcode 6 is obsolete on TravisCI
# Xcode 7 is too old for .NET Core
# Xcode 8 takes too long with all 3 types of integration test, so MakeFile is removed as it's checked in Linux
# Xcode 9 takes too long even with just 2 types, so only Native is run
# Xcode 10 - removed 32-bit support
